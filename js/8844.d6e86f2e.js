"use strict";(self["webpackChunkopencdms_app"]=self["webpackChunkopencdms_app"]||[]).push([[8844],{8844:function(e,t,l){l.r(t),l.d(t,{default:function(){return P}});var o=l(3396);function a(e,t,l,a,n,i){const u=(0,o.up)("Host",!0);return(0,o.wg)(),(0,o.iD)("div",null,[(0,o.Wm)(u)])}var n=l(7139);function i(e,t,l,a,i,u){const s=(0,o.up)("v-card-title"),r=(0,o.up)("v-text-field"),d=(0,o.up)("v-card-item"),m=(0,o.up)("geometry-picker"),p=(0,o.up)("v-autocomplete"),c=(0,o.up)("VueDatePicker"),h=(0,o.up)("v-col"),v=(0,o.up)("v-row"),_=(0,o.up)("v-container"),f=(0,o.up)("LinkForm"),w=(0,o.up)("v-form"),V=(0,o.up)("v-btn"),y=(0,o.up)("v-card-text"),g=(0,o.up)("v-card");return(0,o.wg)(),(0,o.j4)(g,null,{default:(0,o.w5)((()=>[(0,o.Wm)(s,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,n.zw)(e.route.params.id?"Edit":"Create new")+" station details",1)])),_:1}),(0,o.Wm)(y,null,{default:(0,o.w5)((()=>[(0,o.Wm)(w,null,{default:(0,o.w5)((()=>[(0,o.Wm)(d,null,{default:(0,o.w5)((()=>[(0,o.Wm)(r,{label:"id",modelValue:e.host.id,"onUpdate:modelValue":t[0]||(t[0]=t=>e.host.id=t),hint:"ID / primary key","persistent-hint":""},null,8,["modelValue"])])),_:1}),(0,o.Wm)(d,null,{default:(0,o.w5)((()=>[(0,o.Wm)(r,{label:"name",modelValue:e.host.name,"onUpdate:modelValue":t[1]||(t[1]=t=>e.host.name=t),hint:"Preferred name of host","persistent-hint":""},null,8,["modelValue"])])),_:1}),(0,o.Wm)(d,null,{default:(0,o.w5)((()=>[(0,o.Wm)(r,{label:"description",modelValue:e.host.description,"onUpdate:modelValue":t[2]||(t[2]=t=>e.host.description=t),hint:"Description of host","persistent-hint":""},null,8,["modelValue"])])),_:1}),(0,o.Wm)(d,null,{default:(0,o.w5)((()=>[(0,o.Wm)(m,{modelValue:e.host.location,"onUpdate:modelValue":t[3]||(t[3]=t=>e.host.location=t),style:{height:"100%"}},null,8,["modelValue"])])),_:1}),(0,o.Wm)(d,null,{default:(0,o.w5)((()=>[(0,o.Wm)(r,{label:"elevation",modelValue:e.host.elevation,"onUpdate:modelValue":t[4]||(t[4]=t=>e.host.elevation=t),type:"number",hint:"Elevation of station above mean sea level in meters","persistent-hint":""},null,8,["modelValue"])])),_:1}),(0,o.Wm)(d,null,{default:(0,o.w5)((()=>[(0,o.Wm)(r,{label:"wigos_station_identifier",modelValue:e.host.wigos_station_identifier,"onUpdate:modelValue":t[5]||(t[5]=t=>e.host.wigos_station_identifier=t),hint:"WIGOS station identifier","persistent-hint":""},null,8,["modelValue"])])),_:1}),(0,o.Wm)(d,null,{default:(0,o.w5)((()=>[(0,o.Wm)(p,{items:e.facilityTypeOptions,"item-title":"name","item-value":"id",label:"facility_type",modelValue:e.host.facility_type,"onUpdate:modelValue":t[6]||(t[6]=t=>e.host.facility_type=t),hint:e.facilityTypeOptionsHint,"return-object":"","persistent-hint":""},null,8,["items","modelValue","hint"])])),_:1}),(0,o.Wm)(d,null,{default:(0,o.w5)((()=>[(0,o.Wm)(_,null,{default:(0,o.w5)((()=>[(0,o.Wm)(v,null,{default:(0,o.w5)((()=>[(0,o.Wm)(h,{cols:4},{default:(0,o.w5)((()=>[(0,o.Wm)(c,{label:"date_established",modelValue:e.host.date_established,"onUpdate:modelValue":t[7]||(t[7]=t=>e.host.date_established=t),hint:"Date host was first established","persistent-hint":""},null,8,["modelValue"])])),_:1}),(0,o.Wm)(h,{cols:4},{default:(0,o.w5)((()=>[(0,o.Wm)(c,{label:"date_closed",modelValue:e.host.date_closed,"onUpdate:modelValue":t[8]||(t[8]=t=>e.host.date_closed=t),hint:"Date host was first established","persistent-hint":""},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1}),(0,o.Wm)(d,null,{default:(0,o.w5)((()=>[(0,o.Wm)(p,{items:e.wmoRegionOptions,"item-title":"name","item-value":"id",label:"wmo_region",modelValue:e.host.wmo_region,"onUpdate:modelValue":t[9]||(t[9]=t=>e.host.wmo_region=t),hint:e.wmoRegionOptionsHint,"return-object":"","persistent-hint":""},null,8,["items","modelValue","hint"])])),_:1}),(0,o.Wm)(d,null,{default:(0,o.w5)((()=>[(0,o.Wm)(p,{items:e.territoryOptions,"item-title":"name","item-value":"id",label:"territory",modelValue:e.host.territory,"onUpdate:modelValue":t[10]||(t[10]=t=>e.host.territory=t),hint:e.territoryOptionsHint,"return-object":"","persistent-hint":""},null,8,["items","modelValue","hint"])])),_:1}),(0,o.Wm)(d,null,{default:(0,o.w5)((()=>[(0,o.Wm)(p,{items:e.timeZoneOptions,"item-title":"name","item-value":"id",label:"time_zone",modelValue:e.host.time_zone,"onUpdate:modelValue":t[11]||(t[11]=t=>e.host.time_zone=t),hint:e.timeZoneOptionsHint,"return-object":"","persistent-hint":""},null,8,["items","modelValue","hint"])])),_:1}),(0,o.Wm)(d,null,{default:(0,o.w5)((()=>[(0,o.Wm)(_,null,{default:(0,o.w5)((()=>[(0,o.Wm)(v,null,{default:(0,o.w5)((()=>[(0,o.Wm)(h,{cols:4},{default:(0,o.w5)((()=>[(0,o.Wm)(c,{label:"valid_from",modelValue:e.host.valid_from,"onUpdate:modelValue":t[12]||(t[12]=t=>e.host.valid_from=t),hint:"Date from which the details for this record are valid","persistent-hint":""},null,8,["modelValue"])])),_:1}),(0,o.Wm)(h,{cols:4},{default:(0,o.w5)((()=>[(0,o.Wm)(c,{label:"valid_to",modelValue:e.host.valid_to,"onUpdate:modelValue":t[13]||(t[13]=t=>e.host.valid_to=t),hint:"Date after which the details for this record are no longer valid","persistent-hint":""},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1}),(0,o.Wm)(d,null,{default:(0,o.w5)((()=>[(0,o.Wm)(f,{links:e.host.links,onUpdateLinks:t[14]||(t[14]=t=>e.host.links=t)},null,8,["links"])])),_:1}),(0,o.Wm)(d,null,{default:(0,o.w5)((()=>[(0,o.Wm)(r,{label:"_version",modelValue:e.host._version,"onUpdate:modelValue":t[15]||(t[15]=t=>e.host._version=t),type:"number",hint:"Version number of this record (autoupdated)","persistent-hint":"",readonly:""},null,8,["modelValue"])])),_:1}),(0,o.Wm)(d,null,{default:(0,o.w5)((()=>[(0,o.Wm)(r,{label:"_change_date",modelValue:e.host._change_date,"onUpdate:modelValue":t[16]||(t[16]=t=>e.host._change_date=t),hint:"Date this record was changed (autoupdated)","persistent-hint":"",readonly:""},null,8,["modelValue"])])),_:1}),(0,o.Wm)(d,null,{default:(0,o.w5)((()=>[(0,o.Wm)(p,{items:e.userOptions,"item-title":"name","item-value":"id",label:"user",modelValue:e.host._user,"onUpdate:modelValue":t[17]||(t[17]=t=>e.host._user=t),hint:e.userOptionsHint,"return-object":"","persistent-hint":""},null,8,["items","modelValue","hint"])])),_:1}),(0,o.Wm)(d,null,{default:(0,o.w5)((()=>[(0,o.Wm)(p,{items:e.statusOptions,"item-title":"name","item-value":"id",label:"status",modelValue:e.host._status,"onUpdate:modelValue":t[18]||(t[18]=t=>e.host._status=t),hint:e.statusOptionsHint,"return-object":"","persistent-hint":""},null,8,["items","modelValue","hint"])])),_:1}),(0,o.Wm)(d,null,{default:(0,o.w5)((()=>[(0,o.Wm)(r,{label:"comments",modelValue:e.host.comments,"onUpdate:modelValue":t[19]||(t[19]=t=>e.host.comments=t),hint:"Free text comments on this record, for example description of changes made etc","persistent-hint":""},null,8,["modelValue"])])),_:1})])),_:1}),(0,o.Wm)(V,{onClick:e.createHost},{default:(0,o.w5)((()=>[(0,o.Uk)((0,n.zw)(e.route.params.id?"Save":"Create"),1)])),_:1},8,["onClick"]),(0,o.Wm)(V,{onClick:e.cancelEdit},{default:(0,o.w5)((()=>[(0,o.Uk)("Cancel")])),_:1},8,["onClick"])])),_:1})])),_:1})}l(7658),l(774);var u=l(4870),s=l(1489),r=l(6572),d=l(1888),m=l(1209),p=l(165),c=l(240),h=l(2650),v=l(6422),_=l(870),f=l(3369),w=l(8521),V=l(6824),y=l(3968),g=l(1995),W=l(5708),b=l(2497),k=l(2483),O=l(8573),L=l(4562),U=l(3423),Z=l(7085),H=l(9597),C=l(2815),F=l(5206),S=(0,o.aZ)({name:"HostForm",props:{},methods:{parseLinks(e){let t;return t=e&&e.length>0?JSON.stringify(e):"",t}},components:{VCard:s._,VCardTitle:r.E,VCardText:d.Z,VCardItem:m._,VTextField:p.hw,VSelect:c.r,VAutocomplete:h.f,VForm:v.O,VBtn:_.T,VueDatePicker:W.Z,GeometryPicker:b.Z,LinkForm:g.Z,VContainer:f.K,VCol:w.D,VRow:V.o},setup(){const e=(0,k.yj)(),t=(0,k.tv)(),l=(0,u.iH)([]),a=e=>{console.log("updating links"),T.value.links=e},n=(0,y.lL)(O.Z),i=(0,o.Fl)((()=>n.all())),s=(0,o.Fl)((()=>T.value.facility_type?"description"in T.value.facility_type?T.value.facility_type.description:"":"Select facility_type")),r=(0,y.lL)(L.Z),d=(0,o.Fl)((()=>r.all())),m=(0,o.Fl)((()=>T.value.wmo_region?"description"in T.value.wmo_region?T.value.wmo_region.description:"":"Select wmo_region")),p=(0,y.lL)(U.Z),c=(0,o.Fl)((()=>p.all())),h=(0,o.Fl)((()=>T.value.territory?"description"in T.value.territory?T.value.territory.description:"":"Select territory")),v=(0,y.lL)(Z.Z),_=(0,o.Fl)((()=>v.all())),f=(0,o.Fl)((()=>T.value.time_zone?"description"in T.value.time_zone?T.value.time_zone.description:"":"Select time_zone")),w=(0,y.lL)(H.Z),V=(0,o.Fl)((()=>w.all())),g=(0,o.Fl)((()=>T.value._user?"description"in T.value._user?T.value._user.description:"":"Select user")),W=(0,y.lL)(C.Z),b=(0,o.Fl)((()=>W.all())),S=(0,o.Fl)((()=>T.value._status?"description"in T.value._status?T.value._status.description:"":"Select status")),D=(0,y.lL)(F.Z),T=(0,u.iH)(null);console.log(e.params),e.params.id?(T.value=(0,y.lL)(F.Z).with("territory").with("wmo_region").with("facility_type").with("time_zone").with("_user").with("_status").where("id",e.params.id).first(),console.log(T.value)):T.value=(0,y.lL)(F.Z).make();const x=async()=>{console.log("saving"),console.log(T.value);let e={};Object.assign(e,T.value),await D.save(e),t.push("/station/"+T.value.id)},j=async()=>{t.push("/station/"+e.params.id)};(0,o.YP)(T.value,(e=>{console.log(e)}));const z=()=>{Object.assign(T.value,D.make())};return(0,o.bv)((()=>{e.params.id?T.value._version=T.value._version+1:(T.value._version=1,T.value._user=(0,y.lL)(H.Z).where("id","tag:beta.opencdms.org,2023:/data/user/default").first(),T.value._status=(0,y.lL)(C.Z).where("id","tag:beta.opencdms.org,2023:/vocab/status/draft").first())})),{host:T,createHost:x,cancelEdit:j,resetHost:z,links:l,updateLinks:a,facilityTypeOptions:i,facilityTypeOptionsHint:s,wmoRegionOptions:d,wmoRegionOptionsHint:m,territoryOptions:c,territoryOptionsHint:h,timeZoneOptions:_,timeZoneOptionsHint:f,userOptions:V,userOptionsHint:g,statusOptions:b,statusOptionsHint:S,route:e}}}),D=l(89);const T=(0,D.Z)(S,[["render",i]]);var x=T,j={name:"hostForm",components:{Host:x}};const z=(0,D.Z)(j,[["render",a]]);var P=z},2497:function(e,t,l){l.d(t,{Z:function(){return g}});var o=l(3396);function a(e,t,l,a,n,i){const u=(0,o.up)("v-card-title"),s=(0,o.up)("base-map"),r=(0,o.up)("v-card-text"),d=(0,o.up)("v-card"),m=(0,o.up)("v-col"),p=(0,o.up)("v-text-field"),c=(0,o.up)("v-row"),h=(0,o.up)("v-container");return(0,o.wg)(),(0,o.j4)(h,null,{default:(0,o.w5)((()=>[(0,o.Wm)(c,null,{default:(0,o.w5)((()=>[(0,o.Wm)(m,{cols:6},{default:(0,o.w5)((()=>[(0,o.Wm)(d,{style:{"min-height":"500px"}},{default:(0,o.w5)((()=>[(0,o.Wm)(u,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Select location")])),_:1}),(0,o.Wm)(r,{style:{height:"500px"}},{default:(0,o.w5)((()=>[(0,o.Wm)(s,{onMapLoaded:e.onMapLoaded,onClick:e.selectGeometry},null,8,["onMapLoaded","onClick"])])),_:1})])),_:1})])),_:1}),(0,o.Wm)(m,{cols:6},{default:(0,o.w5)((()=>[(0,o.Wm)(c,null,{default:(0,o.w5)((()=>[(0,o.Wm)(m,{cols:12},{default:(0,o.w5)((()=>[(0,o.Wm)(p,{label:"Longitude",modelValue:e.geom.geometry.coordinates[0],"onUpdate:modelValue":t[0]||(t[0]=t=>e.geom.geometry.coordinates[0]=t),type:"number",hint:"Longitude (-180 to 180)","persistent-hint":""},null,8,["modelValue"])])),_:1})])),_:1}),(0,o.Wm)(c,null,{default:(0,o.w5)((()=>[(0,o.Wm)(m,{cols:12},{default:(0,o.w5)((()=>[(0,o.Wm)(p,{label:"Latitude",modelValue:e.geom.geometry.coordinates[1],"onUpdate:modelValue":t[1]||(t[1]=t=>e.geom.geometry.coordinates[1]=t),type:"number",hint:"Latitude (-90 to 90)","persistent-hint":""},null,8,["modelValue"])])),_:1})])),_:1}),(0,o.Wm)(c,null,{default:(0,o.w5)((()=>[(0,o.Wm)(m,{cols:12}),(0,o.Wm)(p,{label:"WKT",modelValue:e.geom.properties.wkt,"onUpdate:modelValue":t[2]||(t[2]=t=>e.geom.properties.wkt=t),hint:"autogenerated",readonly:"","persistent-hint":""},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1})}var n=l(3153),i=l.n(n),u=l(4870),s=l(1489),r=l(6572),d=l(1209),m=l(1888),p=l(3369),c=l(6824),h=l(8521),v=l(165),_=l(9129),f=l(2257),w=(0,o.aZ)({name:"GeometryPicker",props:{geometry_type:{type:String,default:"point"},modelValue:{type:String,default:""}},components:{VCard:s._,VCardTitle:r.E,VCardItem:d._,VCardText:m.Z,VContainer:p.K,VRow:c.o,VCol:h.D,VTextField:v.hw,BaseMap:f.Z},emits:["update:modelValue"],setup(e,{emit:t}){const l=(0,u.iH)(!0),a=(0,u.iH)({type:"Feature",geometry:{type:"Point",coordinates:[null,null]},properties:{wkt:""}}),n=(0,u.iH)(null),s=(0,u.iH)(null),r=((0,u.iH)(""),async e=>{n.value=e,s.value=i().geoJSON().addTo(n.value),null!=a.value.geometry.coordinates[0]&null!=a.value.geometry.coordinates[1]&&(s.value.addData(a.value),n.value.setView([a.value.geometry.coordinates[1],a.value.geometry.coordinates[0]]))}),d=t=>{if(n.value.dragging._draggable._moved||!l.value)return;const o=n.value.mouseEventToLatLng(t);var i=new _.Wkt;"point"===e.geometry_type&&(a.value.geometry.coordinates=[o.lng,o.lat],i.read(JSON.stringify(a.value)),a.value.properties.wkt="SRID=4326; "+i.write(),m(n))};(0,o.YP)((()=>a),(e=>{var t=new _.Wkt;t.read(JSON.stringify(a.value)),a.value.properties.wkt="SRID=4326; "+t.write(),m(n)}),{deep:!0}),(0,o.YP)((()=>e.modelValue),(e=>{if(e){a.value.properties.wkt=e;const t=e.match(/POINT\(([-\d\.]+)\s+([-\d\.]+)\)/),l=[parseFloat(t[1]),parseFloat(t[2])];a.value.geometry.coordinates=l,n.value&&m(n)}}),{immediate:!0});const m=e=>{e.value&&null!=a.value.geometry.coordinates[0]&null!=a.value.geometry.coordinates[1]&&(s.value.clearLayers(),s.value.addData(a.value),e.value.setView([a.value.geometry.coordinates[1],a.value.geometry.coordinates[0]]),t("update:modelValue",a.value.properties.wkt))};return{map:n,onMapLoaded:r,selectGeometry:d,geom:a}}}),V=l(89);const y=(0,V.Z)(w,[["render",a]]);var g=y}}]);
//# sourceMappingURL=8844.d6e86f2e.js.map