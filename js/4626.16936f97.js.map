{"version":3,"file":"js/4626.16936f97.js","mappings":"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","sources":["webpack://opencdms-app/./src/views/station-list.vue","webpack://opencdms-app/./src/web-components/station-list.vue","webpack://opencdms-app/./src/web-components/station-list.vue?06bf","webpack://opencdms-app/./src/views/station-list.vue?60b4","webpack://opencdms-app/../../src/composables/filter.ts"],"sourcesContent":["<template>\n  <div>\n    <station-list/>\n  </div>\n</template>\n\n<script>\nimport StationList from './../web-components/station-list.vue';\n\n\nexport default {\n  name: 'MyView',\n  components: {\n    StationList,\n  },\n};\n</script>\n\n<style>\n</style>\n","<template>\n  <v-card>\n    <v-card-title>Stations</v-card-title>\n    <v-card-text>\n      <VTextField style=\"width: 400px;\" v-model=\"search\" prepend-icon=\"mdi-text-search\" label=\"search\" single-line hide-details></VTextField>\n      <VDataTable :headers=\"headers\" :items=\"items\" :search=\"search\" dense small>\n          <template v-slot:item.id=\"{ item }\">\n            <a :href=\"getIDLink(item.raw.id)\">{{item.raw.id}}</a>\n          </template>\n          <template v-slot:item.links=\"{ item }\">\n            {{parseLinks(item.raw.links)}}\n          </template>\n      </VDataTable>\n    </v-card-text>\n  </v-card>\n</template>\n\n<script>\nimport { defineComponent } from 'vue';\nimport { VCard, VCardTitle, VCardText, VChip } from 'vuetify/lib/components';\nimport { onBeforeMount, onMounted, onBeforeUpdate, onUpdated, onBeforeUnmount, onUnmounted, onErrorCaptured} from 'vue';\nimport { ref, computed, watchEffect, watch } from 'vue'\nimport { VDataTable } from 'vuetify/labs/VDataTable';\nimport { VTextField } from 'vuetify/lib/components';\nimport {useRepo} from 'pinia-orm';\nimport * as d3 from 'd3';\n\n// opencdms components\n\nimport Host from '@/models/Host';\n\nexport default defineComponent({\n  name: 'station-list',\n  props: {\n    connection: {\n      type: String,\n      default: \"/data/hosts.psv\"\n    }\n  },\n  components: {\n    VCard,\n    VCardTitle,\n    VCardText,\n    VDataTable,\n    VTextField,\n  },\n  methods: {\n    parseLinks (links) {\n      let res;\n      if( links && links.length > 0 ){\n        res = JSON.stringify(links);\n      }else{\n        res = '';\n      }\n      return res;\n    },\n    getIDLink (id) {\n      return '/#/station/'+id;\n    }\n  },\n  setup(props) {\n    const headers = ref([]);\n    const data = ref([]);\n    const search = ref(\"\");\n    const sortBy = ref([{key:\"\", order:\"desc\"}]);\n    const items = ref([]);\n    const selected = ref([]);\n\n    const hostRepo = useRepo(Host);\n\n    console.log(useRepo(Host).piniaStore());\n\n    const loadCSV = async (path) => {\n      let csvData;\n      csvData = await d3.dsv('|',path, d3.autoType);\n      return {csvData};\n    };\n\n    onMounted( async() => {\n        items.value = hostRepo.all();\n        headers.value = Object.keys(items.value[0]).map( key => ({\n            //title: key.replace(\"cdm_\",\"\"),\n          title: key,\n          value: key,\n          key: key,\n          sortable: true\n        }));\n        console.log(hostRepo.all()) ;\n      //}\n\n      console.log(headers);\n      console.log(hostRepo.all());\n    });\n    return {headers, items, search, sortBy};\n  }\n\n});\n</script>\n","import { render } from \"./station-list.vue?vue&type=template&id=da84f4b4\"\nimport script from \"./station-list.vue?vue&type=script&lang=js\"\nexport * from \"./station-list.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"/home/runner/work/opencdms-app/opencdms-app/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","import { render } from \"./station-list.vue?vue&type=template&id=3e4f1ddc\"\nimport script from \"./station-list.vue?vue&type=script&lang=js\"\nexport * from \"./station-list.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"/home/runner/work/opencdms-app/opencdms-app/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","/* eslint-disable max-statements */\n/* eslint-disable no-labels */\n\n// Utilities\nimport { getPropertyFromItem, propsFactory, wrapInArray } from '@/util'\nimport { computed, ref, unref, watchEffect } from 'vue'\n\n// Types\nimport type { PropType, Ref } from 'vue'\nimport type { MaybeRef } from '@/util'\nimport type { InternalItem } from './items'\n\n/**\n * - match without highlight\n * - single match (index), length already known\n * - single match (start, end)\n * - multiple matches (start, end), probably shouldn't overlap\n */\nexport type FilterMatch = boolean | number | [number, number] | [number, number][]\nexport type FilterFunction = (value: string, query: string, item?: any) => FilterMatch\nexport type FilterKeyFunctions = Record<string, FilterFunction>\nexport type FilterKeys = string | string[]\nexport type FilterMode = 'some' | 'every' | 'union' | 'intersection'\n\nexport interface FilterProps {\n  customFilter?: FilterFunction\n  customKeyFilter?: FilterKeyFunctions\n  filterKeys?: FilterKeys\n  filterMode?: FilterMode\n  noFilter?: boolean\n}\n\n// Composables\nexport const defaultFilter: FilterFunction = (value, query, item) => {\n  if (value == null || query == null) return -1\n\n  return value.toString().toLocaleLowerCase().indexOf(query.toString().toLocaleLowerCase())\n}\n\nexport const makeFilterProps = propsFactory({\n  customFilter: Function as PropType<FilterFunction>,\n  customKeyFilter: Object as PropType<FilterKeyFunctions>,\n  filterKeys: [Array, String] as PropType<FilterKeys>,\n  filterMode: {\n    type: String as PropType<FilterMode>,\n    default: 'intersection',\n  },\n  noFilter: Boolean,\n}, 'filter')\n\nexport function filterItems (\n  items: InternalItem[],\n  query: string,\n  options?: {\n    customKeyFilter?: FilterKeyFunctions\n    default?: FilterFunction\n    filterKeys?: FilterKeys\n    filterMode?: FilterMode\n    noFilter?: boolean\n  },\n) {\n  const array: { index: number, matches: Record<string, FilterMatch> }[] = []\n  // always ensure we fall back to a functioning filter\n  const filter = options?.default ?? defaultFilter\n  const keys = options?.filterKeys ? wrapInArray(options.filterKeys) : false\n  const customFiltersLength = Object.keys(options?.customKeyFilter ?? {}).length\n\n  if (!items?.length) return array\n\n  loop:\n  for (let i = 0; i < items.length; i++) {\n    const item = items[i]\n    const customMatches: Record<string, FilterMatch> = {}\n    const defaultMatches: Record<string, FilterMatch> = {}\n    let match: FilterMatch = -1\n\n    if (query && !options?.noFilter) {\n      if (typeof item === 'object') {\n        const filterKeys = keys || Object.keys(item)\n\n        for (const key of filterKeys) {\n          const value = getPropertyFromItem(item as any, key, item)\n          const keyFilter = options?.customKeyFilter?.[key]\n\n          match = keyFilter\n            ? keyFilter(value, query, item)\n            : filter(value, query, item)\n\n          if (match !== -1 && match !== false) {\n            if (keyFilter) customMatches[key] = match\n            else defaultMatches[key] = match\n          } else if (options?.filterMode === 'every') {\n            continue loop\n          }\n        }\n      } else {\n        match = filter(item, query, item)\n        if (match !== -1 && match !== false) {\n          defaultMatches.title = match\n        }\n      }\n\n      const defaultMatchesLength = Object.keys(defaultMatches).length\n      const customMatchesLength = Object.keys(customMatches).length\n\n      if (!defaultMatchesLength && !customMatchesLength) continue\n\n      if (\n        options?.filterMode === 'union' &&\n        customMatchesLength !== customFiltersLength &&\n        !defaultMatchesLength\n      ) continue\n\n      if (\n        options?.filterMode === 'intersection' &&\n        (\n          customMatchesLength !== customFiltersLength ||\n          !defaultMatchesLength\n        )\n      ) continue\n    }\n\n    array.push({ index: i, matches: { ...defaultMatches, ...customMatches } })\n  }\n\n  return array\n}\n\nexport function useFilter <T extends InternalItem> (\n  props: FilterProps,\n  items: MaybeRef<T[]>,\n  query: Ref<string | undefined>,\n  options?: {\n    filterKeys?: MaybeRef<FilterKeys>\n  }\n) {\n  const strQuery = computed(() => (\n    typeof query?.value !== 'string' &&\n    typeof query?.value !== 'number'\n  ) ? '' : String(query.value))\n\n  const filteredItems: Ref<T[]> = ref([])\n  const filteredMatches: Ref<Map<unknown, Record<string, FilterMatch>>> = ref(new Map())\n\n  watchEffect(() => {\n    filteredItems.value = []\n    filteredMatches.value = new Map()\n\n    const transformedItems = unref(items)\n    const results = filterItems(\n      transformedItems,\n      strQuery.value,\n      {\n        customKeyFilter: props.customKeyFilter,\n        default: props.customFilter,\n        filterKeys: unref(options?.filterKeys) ?? props.filterKeys,\n        filterMode: props.filterMode,\n        noFilter: props.noFilter,\n      },\n    )\n\n    results.forEach(({ index, matches }) => {\n      const item = transformedItems[index]\n      filteredItems.value.push(item)\n      filteredMatches.value.set(item.value, matches)\n    })\n  })\n\n  function getMatches (item: T) {\n    return filteredMatches.value.get(item.value)\n  }\n\n  return { filteredItems, filteredMatches, getMatches }\n}\n"],"names":["_createElementBlock","_createVNode","_component_station_list","_createBlock","_component_v_card","_component_v_card_title","_component_v_card_text","_component_VTextField","style","_ctx","label","_component_VDataTable","headers","items","search","dense","small","item","_createElementVNode","href","raw","id","links","defineComponent","name","props","connection","type","String","default","components","VCard","VCardTitle","VCardText","VDataTable","VTextField","methods","parseLinks","res","length","JSON","stringify","getIDLink","setup","ref","sortBy","key","order","hostRepo","useRepo","Host","console","log","piniaStore","onMounted","async","value","all","Object","keys","map","title","sortable","__exports__","StationList","render","defaultFilter","query","toString","toLocaleLowerCase","indexOf","makeFilterProps","propsFactory","customFilter","Function","customKeyFilter","filterKeys","Array","filterMode","noFilter","Boolean","filterItems","options","array","filter","wrapInArray","customFiltersLength","loop","i","customMatches","defaultMatches","match","getPropertyFromItem","keyFilter","defaultMatchesLength","customMatchesLength","push","index","matches","useFilter","strQuery","computed","filteredItems","filteredMatches","Map","getMatches","get","watchEffect","transformedItems","unref","results","forEach","_ref","set"],"sourceRoot":""}