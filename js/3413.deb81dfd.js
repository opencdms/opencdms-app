"use strict";(self["webpackChunkopencdms_app"]=self["webpackChunkopencdms_app"]||[]).push([[3413],{3581:function(e,t,l){l.r(t),l.d(t,{default:function(){return T}});var a={};l.r(a);var o=l(3396);function r(e,t,l,a,r,s){const n=(0,o.up)("data-station");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o.Wm)(n)])}var s=l(7139);const n=(0,o._)("a",{href:"{{baseURL}}{{dataURL}}"},null,-1),u=["href"];function i(e,t,l,a,r,i){const d=(0,o.up)("v-card-title"),p=(0,o.up)("select-host"),c=(0,o.up)("v-card-text"),m=(0,o.up)("v-card"),g=(0,o.up)("v-col"),v=(0,o.up)("v-row"),f=(0,o.up)("select-observed-property"),h=(0,o.up)("VueDatePicker"),y=(0,o.up)("v-container"),w=(0,o.up)("v-card-item"),_=(0,o.up)("v-btn"),b=(0,o.up)("v-text-field"),k=(0,o.up)("v-card-subtitle"),S=(0,o.up)("VDataTable");return(0,o.wg)(),(0,o.j4)(y,{style:{width:"100%"}},{default:(0,o.w5)((()=>[(0,o.Wm)(v,null,{default:(0,o.w5)((()=>[(0,o.Wm)(g,{cols:12},{default:(0,o.w5)((()=>[(0,o.Wm)(m,null,{default:(0,o.w5)((()=>[(0,o.Wm)(d,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Select station")])),_:1}),(0,o.Wm)(c,null,{default:(0,o.w5)((()=>[(0,o.Wm)(p,{modelValue:e.query_param.host,"onUpdate:modelValue":t[0]||(t[0]=t=>e.query_param.host=t)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1}),e.query_param.host?((0,o.wg)(),(0,o.j4)(v,{key:0},{default:(0,o.w5)((()=>[(0,o.Wm)(g,{cols:12},{default:(0,o.w5)((()=>[(0,o.Wm)(m,null,{default:(0,o.w5)((()=>[(0,o.Wm)(d,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Select from available data for "+(0,s.zw)(e.$route.params.id),1)])),_:1}),(0,o.Wm)(w,null,{default:(0,o.w5)((()=>[(0,o.Wm)(y,null,{default:(0,o.w5)((()=>[(0,o.Wm)(v,null,{default:(0,o.w5)((()=>[(0,o.Wm)(g,{cols:4},{default:(0,o.w5)((()=>[(0,o.Wm)(f,{modelValue:e.query_param.observed_property,"onUpdate:modelValue":t[1]||(t[1]=t=>e.query_param.observed_property=t)},null,8,["modelValue"])])),_:1}),(0,o.Wm)(g,{cols:4},{default:(0,o.w5)((()=>[(0,o.Wm)(h,{"text-input":"",format:"yyyy-MM-dd","enable-time-picker":!1,label:"Start",modelValue:e.query_param.start_date,"onUpdate:modelValue":t[2]||(t[2]=t=>e.query_param.start_date=t),hint:"Start date","persistent-hint":"",teleport:!0},null,8,["modelValue"])])),_:1}),(0,o.Wm)(g,{cols:4},{default:(0,o.w5)((()=>[(0,o.Wm)(h,{"text-input":"",format:"yyyy-MM-dd","enable-time-picker":!1,label:"End",modelValue:e.query_param.end_date,"onUpdate:modelValue":t[3]||(t[3]=t=>e.query_param.end_date=t),hint:"End date","persistent-hint":"",teleport:!0},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):(0,o.kq)("",!0),e.query_param.host?((0,o.wg)(),(0,o.j4)(v,{key:1},{default:(0,o.w5)((()=>[(0,o.Wm)(g,null,{default:(0,o.w5)((()=>[(0,o.Wm)(m,null,{default:(0,o.w5)((()=>[(0,o.Wm)(_,{onClick:e.fetchData},{default:(0,o.w5)((()=>[(0,o.Uk)("Preview")])),_:1},8,["onClick"])])),_:1})])),_:1}),(0,o.Wm)(g,null,{default:(0,o.w5)((()=>[(0,o.Wm)(m,null,{default:(0,o.w5)((()=>[(0,o.Wm)(_,{onClick:e.downloadData},{default:(0,o.w5)((()=>[(0,o.Uk)("Download")])),_:1},8,["onClick"])])),_:1})])),_:1}),(0,o.Wm)(g,null,{default:(0,o.w5)((()=>[(0,o.Wm)(m,null,{default:(0,o.w5)((()=>[(0,o.Wm)(b,{hint:"Number of records to download","persistent-hint":"",label:"Limit",modelValue:e.maxItems,"onUpdate:modelValue":t[4]||(t[4]=t=>e.maxItems=t),type:"number",min:"1"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})):(0,o.kq)("",!0),(0,o.Wm)(v,null,{default:(0,o.w5)((()=>[(0,o.Wm)(g,{cols:12},{default:(0,o.w5)((()=>[(0,o.Wm)(m,null,{default:(0,o.w5)((()=>[(0,o.Wm)(d,null,{default:(0,o.w5)((()=>[(0,o.Uk)("Results preview")])),_:1}),(0,o.Wm)(k,null,{default:(0,o.w5)((()=>[n,(0,o.Uk)((0,s.zw)(e.baseURL)+(0,s.zw)(e.dataURL),1)])),_:1}),(0,o.Wm)(c,null,{default:(0,o.w5)((()=>[(0,o.Wm)(S,{items:e.items,headers:e.headers,dense:"",small:""},{"item.id":(0,o.w5)((({item:t})=>[(0,o._)("a",{href:e.getIDLink(t.raw.id)},(0,s.zw)(t.raw.id),9,u)])),"item.links":(0,o.w5)((({item:t})=>[(0,o.Uk)((0,s.zw)(e.parseLinks(t.raw.links)),1)])),_:1},8,["items","headers"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})}var d=l(4870),p=l(3238),c=l(6572),m=l(1332),g=l(1888),v=l(1209),f=l(3144),h=l(9870),y=l(870),w=l(2900),_=l(2650),b=l(5557),k=l(3369),S=l(8521),V=l(6824),C=l(2483),W=l(3968),H=l(839),P=l(3280),x=l(1475),L=l(7082);l(774),l(7658),l(9242);(0,o.aZ)({name:"my-table",emits:["return-checked-rows","do-search","is-finished","get-now-page","row-clicked","row-toggled"],props:{isLoading:{type:Boolean,require:!0},isReSearch:{type:Boolean,require:!0},hasCheckbox:{type:Boolean,default:!1},checkedReturnType:{type:String,default:"key"},title:{type:String,default:""},isFixedFirstColumn:{type:Boolean,default:!1},columns:{type:Array,default:()=>[]},rows:{type:Array,default:()=>[]},rowClasses:{type:[Array,Function],default:()=>[]},pageSize:{type:Number,default:10},total:{type:Number,default:100},page:{type:Number,default:1},sortable:{type:Object,default:()=>({order:"id",sort:"asc"})},messages:{type:Object,default:()=>({pagingInfo:"Showing {0}-{1} of {2}",pageSizeChangeLabel:"Row count:",gotoPageLabel:"Go to page:",noDataAvailable:"No data"})},isStaticMode:{type:Boolean,default:!1},isSlotMode:{type:Boolean,default:!1},isHidePaging:{type:Boolean,default:!1},pageOptions:{type:Array,default:()=>[{value:10,text:10},{value:25,text:25},{value:50,text:50}]},groupingKey:{type:String,default:""},hasGroupToggle:{type:Boolean,default:!1},groupingDisplay:{type:Function,default:null},maxHeight:{default:"auto"},startCollapsed:{type:Boolean,default:!1},isKeepCollapsed:{type:Boolean,default:!1}},setup(e,{emit:t,slots:l}){let a=(0,d.iH)(null),r=e.pageOptions.length>0?(0,d.iH)(e.pageOptions[0].value):(0,d.iH)(e.pageSize);e.pageOptions.length>0&&e.pageOptions.forEach((t=>{Object.prototype.hasOwnProperty.call(t,"value")&&Object.prototype.hasOwnProperty.call(t,"text")&&e.pageSize==t.value&&(r.value=t.value)}));const s=(0,d.qj)({isSlotMode:e.isSlotMode,isCheckAll:!1,isHidePaging:e.isHidePaging,keyColumn:(0,o.Fl)((()=>{let t="";return Object.assign(e.columns).forEach((e=>{e.isKey&&(t=e.field)})),t})),page:e.page,pageSize:r.value,maxPage:(0,o.Fl)((()=>{if(e.total<=0)return 0;let t=Math.floor(e.total/s.pageSize),l=e.total%s.pageSize;return l>0&&t++,t})),offset:(0,o.Fl)((()=>(s.page-1)*s.pageSize+1)),limit:(0,o.Fl)((()=>{let t=s.page*s.pageSize;return e.total>=t?t:e.total})),paging:(0,o.Fl)((()=>{let e=s.page-2<=0?1:s.page-2;s.maxPage-s.page<=2&&(e=s.maxPage-4),e=e<=0?1:e;let t=[];for(let l=e;l<=s.maxPage;l++)t.length<5&&t.push(l);return t})),order:e.sortable.order,sort:e.sortable.sort,pageOptions:e.pageOptions}),n=(0,d.iH)([]),u=(0,o.Fl)((()=>{let t=e.rows;var l=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"});let a="desc"===s.sort?-1:1;t.sort((function(e,t){return l.compare(e[s.order],t[s.order])*a}));let r=null;if(e.groupingKey){let l={};t.forEach((t=>{l[t[e.groupingKey]]||(l[t[e.groupingKey]]=[]),l[t[e.groupingKey]].push(t)})),r={};for(let a=s.offset-1;a<s.limit;a++)r[t[a][e.groupingKey]]=l[t[a][e.groupingKey]]}else{r=[];for(let e=s.offset-1;e<s.limit;e++)r.push(t[e])}return(0,o.Y3)((function(){_()})),r})),i=(0,d.iH)([]);(0,o.Xn)((()=>{i.value=[]})),(0,o.YP)((()=>s.isCheckAll),(l=>{if(e.hasCheckbox){if(n.value=[],l){let t=e.isStaticMode?e.rows.slice(s.offset-1,s.limit):e.rows;"row"==e.checkedReturnType?n.value=t:t.forEach((e=>{n.value.push(e[s.keyColumn])}))}i.value.forEach((e=>{e&&(e.checked=l)})),t("return-checked-rows",n.value)}})),(0,o.YP)((()=>e.hasCheckbox),(e=>{e||(s.isCheckAll=!1)}));const p=(l,a)=>{a.stopPropagation();let o=l[s.keyColumn];if("row"==e.checkedReturnType&&(o=l),a.target.checked)n.value.push(o);else{const e=n.value.indexOf(o);e>=0&&n.value.splice(e,1)}n.value.length==e.rows.length?s.isCheckAll=!0:t("return-checked-rows",n.value)},c=()=>{n.value=[],i.value.forEach((e=>{e&&e.checked&&(e.checked=!1)})),t("return-checked-rows",n.value)},m=l=>{let a="asc";l==s.order&&"asc"==s.sort&&(a="desc");let o=(s.page-1)*s.pageSize,r=s.pageSize;s.order=l,s.sort=a,t("do-search",o,r,l,a),s.isCheckAll?s.isCheckAll=!1:e.hasCheckbox&&c()},g=(l,a)=>{s.isCheckAll=!1,e.hasCheckbox&&(n.value=[]);let o=s.order,r=s.sort,u=(l-1)*s.pageSize,i=s.pageSize;(!e.isReSearch||l>1||l==a)&&t("do-search",u,i,o,r)};(0,o.YP)((()=>s.page),g),(0,o.YP)((()=>e.page),(e=>{e<=1?(s.page=1,t("get-now-page",s.page)):e>=s.maxPage?(s.page=s.maxPage,t("get-now-page",s.page)):s.page=e}));const v=()=>{1===s.page?g(s.page,s.page):(s.page=1,s.isCheckAll=!1)};(0,o.YP)((()=>s.pageSize),v),(0,o.YP)((()=>e.pageSize),(e=>{s.pageSize=e}));const f=()=>{if(1==s.page)return!1;s.page--},h=e=>{s.page=e},y=()=>{if(s.page>=s.maxPage)return!1;s.page++};(0,o.YP)((()=>e.rows),(()=>{(e.isReSearch||e.isStaticMode)&&(s.page=1),(0,o.Y3)((function(){e.isStaticMode||_()}))}));const w=(e,...t)=>e.replace(/{(\d+)}/g,(function(e,l){return"undefined"!=typeof t[l]?t[l]:e})),_=()=>{if(a.value){let e=a.value.getElementsByClassName("is-rows-el");t("is-finished",e)}t("get-now-page",s.page)},b=(0,d.iH)({}),k=(0,d.iH)({}),S=(0,d.iH)({}),V=(0,o.Fl)((()=>{let t={};return e.rows.forEach((l=>{t[l[e.groupingKey]]||(t[l[e.groupingKey]]=[]),t[l[e.groupingKey]].push(l)})),(0,o.Y3)((function(){if(e.startCollapsed||e.isKeepCollapsed)for(const[t,l]of Object.entries(b.value))if(l){let a=!e.startCollapsed;e.isKeepCollapsed&&void 0!==S.value[t]&&(a=!S.value[t]),(a&&l.parentElement.classList.contains("rotated-90")||!a&&!l.parentElement.classList.contains("rotated-90"))&&l.parentElement.classList.toggle("rotated-90"),a||k.value[t].forEach((e=>{e&&e.classList.add("hidden")}))}_()})),t})),C=e=>{let l=b.value[e];if(l){l.parentElement.classList.toggle("rotated-90");const a=l.parentElement.classList.contains("rotated-90");k.value[e].forEach((e=>{e&&(a?e.classList.add("hidden"):e.classList.remove("hidden"))})),S.value[e]=a,t("row-toggled",V.value[e],a)}},W=e=>{e.target.classList.add("hover")},H=e=>{e.target.classList.remove("hover")};return(0,o.bv)((()=>{(0,o.Y3)((()=>{e.rows.length>0&&_()}))})),{slots:l,localTable:a,localRows:u,setting:s,rowCheckbox:i,checked:p,clearChecked:c,doSort:m,prevPage:f,movePage:h,nextPage:y,stringFormat:w,toggleButtonRefs:b,groupingRowsRefs:k,groupingRows:V,toggleGroup:C,addHoverClassToTr:W,removeHoverClassFromTr:H}}});var R=l(89);var O=l(5206),z=l(2710),F=l(9941),U=(0,o.aZ)({name:"data-table",components:{VCard:p._,VCardTitle:c.E,VCardSubtitle:m.Q,VCardText:g.Z,VCardItem:v._,VTabs:f.d,VTab:h.L,VBtn:y.T,VTextField:w.hw,VAutocomplete:_.f,VContainer:k.K,VCol:S.D,VRow:V.o,VDataTable:b.y,SelectHost:H.Z,SelectObservedProperty:P.Z,VueDatePicker:x.Z,TableLite:a.TableLite},methods:{parseLinks(e){let t;return console.log(e),t=e&&e.length>0?JSON.stringify(e):"",t},getIDLink(e){return"https://green.opencdms.org/collections/observations/items/"+e}},setup(e){const t=(0,d.iH)(null),l=((0,C.tv)(),(0,d.iH)(null)),a=(0,d.iH)(""),r=(0,d.iH)(null),s=(0,d.iH)(null),n=(0,d.iH)("https://green.opencdms.org/collections/observations/items"),u=(0,d.iH)([]),i=(0,d.iH)([]),p=(0,d.iH)(null),c=((0,C.yj)(),(0,d.iH)(""));p.value=1e3;const m=(0,d.iH)({host:null,start_date:null,end_date:null,observed_property:null}),g=async()=>{console.log("Fetchinghttps://green.opencdms.org/collections/observations/items"+a.value),u.value=[];var e=await(0,F.m)("https://green.opencdms.org/collections/observations/items"+a.value,!0).then((e=>(0,z._)(e.features)));u.value=e,console.log(u.value),i.value=[{title:"Record ID",value:"id",key:"id",sortable:!1},{title:"Date/time",value:"phenomenon_end",key:"phenomenon_end",sortable:!1},{title:"Host",value:"host_id",key:"host_id",sortable:!1},{title:"Observed property",value:"observed_property_id",key:"observed_property_id",sortable:!1},{title:"Result value",value:"result_value",key:"result_value",sortable:!1},{title:"Result units",value:"result_uom",key:"result_uom",sortable:!1},{title:"Result quality",value:"result_quality",key:"result_quality",sortable:!1}],console.log(u.value),console.log("Fetch complete")};(0,o.Jd)((()=>{w(),u.value=null,t.value=null,l.value=null,a.value=null,r.value=null,s.value=null,n.value=null,i.value=null,p.value=null})),(0,o.Ah)((()=>{console.log("Unmounted")}));const v=()=>{var e="https://green.opencdms.org/collections/observations/items"+a.value.replace("f=json","f=csv").replace("limit=25","limit="+p.value);window.location.href=e},f=(0,W.lL)(O.Z),h=(0,o.Fl)((()=>f.all())),y=(0,d.iH)(null),w=(0,o.YP)(m.value,(()=>{a.value="?limit=25",m.value.host&&(a.value=a.value+"&host_id="+m.value.host.id),m.value.observed_property&&(a.value=a.value+"&observed_property_id="+m.value.observed_property.id),m.value.start_date&&m.value.end_date&&(console.log(m.value.start_date.getDay()),a.value=a.value+"&datetime="+(0,L.Z)(m.value.start_date).replace("+","%2B")+"/"+(0,L.Z)(m.value.end_date).replace("+","%2B")),a.value=a.value+"&f=json",console.log(m.value)}),{deep:!0});return(0,o.d1)((()=>{})),{host:y,hostOptions:h,selectedHost:t,geom:l,start_date:r,end_date:s,downloadData:v,search:c,query_param:m,dataURL:a,formatISO:L.Z,items:u,headers:i,baseURL:n,maxItems:p,fetchData:g}}});const Z=(0,R.Z)(U,[["render",i]]);var q=Z,D={name:"MyView",components:{DataStation:q}};const E=(0,R.Z)(D,[["render",r]]);var T=E},839:function(e,t,l){l.d(t,{Z:function(){return c}});var a=l(3396);function o(e,t,l,o,r,s){const n=(0,a.up)("v-autocomplete");return(0,a.wg)(),(0,a.j4)(n,{items:e.options,"item-title":"name","item-value":"id",label:"host",modelValue:e.selected,"onUpdate:modelValue":t[0]||(t[0]=t=>e.selected=t),hint:e.selected?e.selected.name:"Select a host","persistent-hint":"","return-object":""},null,8,["items","modelValue","hint"])}var r=l(5206),s=l(3968),n=l(4870),u=l(2650),i=(0,a.aZ)({name:"SelectHost",components:{VAutocomplete:u.f},emits:["update:modelValue"],setup(e,{emit:t}){const l=(0,n.iH)(null),o=(0,a.Fl)((()=>(0,s.lL)(r.Z).all()));console.log(o);(0,a.Fl)((()=>{}));return(0,a.YP)((()=>l.value),(e=>{t("update:modelValue",e)})),{selected:l,options:o}}}),d=l(89);const p=(0,d.Z)(i,[["render",o]]);var c=p},3280:function(e,t,l){l.d(t,{Z:function(){return c}});var a=l(3396);function o(e,t,l,o,r,s){const n=(0,a.up)("v-autocomplete");return(0,a.wg)(),(0,a.j4)(n,{items:e.options,"item-title":"id","item-value":"id",label:"observed property",modelValue:e.selected,"onUpdate:modelValue":t[0]||(t[0]=t=>e.selected=t),hint:e.selected?e.selected.standard_name:"Select an observed property","persistent-hint":"","return-object":""},null,8,["items","modelValue","hint"])}var r=l(2302),s=l(3968),n=l(4870),u=l(2650),i=(0,a.aZ)({name:"SelectObservedProperty",components:{VAutocomplete:u.f},emits:["update:modelValue"],setup(e,{emit:t}){const l=(0,n.iH)(null),o=(0,a.Fl)((()=>(0,s.lL)(r.Z).all()));console.log(o);(0,a.Fl)((()=>{}));return(0,a.YP)((()=>l.value),(e=>{t("update:modelValue",e)})),{selected:l,options:o}}}),d=l(89);const p=(0,d.Z)(i,[["render",o]]);var c=p}}]);
//# sourceMappingURL=3413.deb81dfd.js.map