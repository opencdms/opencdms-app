"use strict";(self["webpackChunkopencdms_app"]=self["webpackChunkopencdms_app"]||[]).push([[7342],{7342:function(e,l,t){t.d(l,{Z:function(){return I}});var a={};t.r(a);var o=t(3396),n=t(7139);function u(e,l,t,a,u,i){const s=(0,o.up)("v-card-title"),r=(0,o.up)("v-text-field"),c=(0,o.up)("v-textarea"),d=(0,o.up)("v-btn"),p=(0,o.up)("v-form"),m=(0,o.up)("v-col"),v=(0,o.up)("base-map"),f=(0,o.up)("v-card-text"),w=(0,o.up)("v-card"),g=(0,o.up)("v-row"),x=(0,o.up)("v-container"),h=(0,o.up)("v-card-subtitle"),V=(0,o.up)("v-card-actions");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(w,null,{default:(0,o.w5)((()=>[(0,o.Wm)(s,null,{default:(0,o.w5)((()=>[(0,o.Uk)(" WIS2.0 Catalogue Search ")])),_:1}),(0,o.Wm)(x,null,{default:(0,o.w5)((()=>[(0,o.Wm)(g,null,{default:(0,o.w5)((()=>[(0,o.Wm)(m,{cols:6},{default:(0,o.w5)((()=>[(0,o.Wm)(p,null,{default:(0,o.w5)((()=>[(0,o.Wm)(r,{label:"min-x",modelValue:e.minx,"onUpdate:modelValue":l[0]||(l[0]=l=>e.minx=l)},null,8,["modelValue"]),(0,o.Wm)(r,{label:"min-y",modelValue:e.miny,"onUpdate:modelValue":l[1]||(l[1]=l=>e.miny=l)},null,8,["modelValue"]),(0,o.Wm)(r,{label:"max-x",modelValue:e.maxx,"onUpdate:modelValue":l[2]||(l[2]=l=>e.maxx=l)},null,8,["modelValue"]),(0,o.Wm)(r,{label:"max-y",modelValue:e.maxy,"onUpdate:modelValue":l[3]||(l[3]=l=>e.maxy=l)},null,8,["modelValue"]),(0,o.Wm)(c,{label:"Keywords (semi-colon (;) delimited)",modelValue:e.keywords,"onUpdate:modelValue":l[4]||(l[4]=l=>e.keywords=l)},null,8,["modelValue"]),(0,o.Wm)(d,{onClick:e.searchCatalogue},{default:(0,o.w5)((()=>[(0,o.Uk)("Search")])),_:1},8,["onClick"])])),_:1})])),_:1}),(0,o.Wm)(m,{cols:6},{default:(0,o.w5)((()=>[(0,o.Wm)(w,{style:{height:"600pt"}},{default:(0,o.w5)((()=>[(0,o.Wm)(f,{style:{height:"100%"}},{default:(0,o.w5)((()=>[(0,o.Wm)(v,{onMapLoaded:e.onMapLoaded,id:"map",onClick:e.mapEvent,zoom:"3"},null,8,["onMapLoaded","onClick"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),(0,o.Wm)(w,null,{default:(0,o.w5)((()=>[(0,o.Wm)(s,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,n.zw)(e.collections.features.length)+" results ",1)])),_:1}),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.collections.features,(l=>((0,o.wg)(),(0,o.j4)(w,null,{default:(0,o.w5)((()=>[(0,o.Wm)(s,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,n.zw)(l.properties.title),1)])),_:2},1024),(0,o.Wm)(h,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,n.zw)(l.id),1)])),_:2},1024),(0,o.Wm)(f,null,{default:(0,o.w5)((()=>[(0,o.Wm)(x,null,{default:(0,o.w5)((()=>[(0,o.Wm)(g,{style:{"min-height":"100px"}},{default:(0,o.w5)((()=>[(0,o.Wm)(m,{cols:12},{default:(0,o.w5)((()=>[(0,o.Uk)((0,n.zw)(l.properties.description),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024),(0,o.Wm)(V,null,{default:(0,o.w5)((()=>[(0,o.Wm)(d,{size:"small",onClick:t=>e.moreInformation(l)},{default:(0,o.w5)((()=>[(0,o.Uk)("More information")])),_:2},1032,["onClick"]),(0,o.Wm)(d,{size:"small",onClick:t=>e.parseLinks(l)},{default:(0,o.w5)((()=>[(0,o.Uk)("Subscribe")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)))),256))])),_:1})],64)}var i=t(4870),s=t(1489),r=t(6572),c=t(1888),d=t(6422),p=t(165),m=t(9242),v=(t(348),t(7173)),f=t(8302),w=t(2816),g=t(7052),x=t(3185),h=t(8969),V=t(8717),y=t(320),k=t(131),W=t(9888);const b=(0,y.ev)()({name:"VTextarea",directives:{Intersect:g.Z},inheritAttrs:!1,props:{autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,hint:String,persistentHint:Boolean,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,...(0,f.co)(),...(0,v.hy)()},emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,l){let{attrs:t,emit:a,slots:n}=l;const u=(0,V.z)(e,"modelValue"),{isFocused:s,focus:r,blur:c}=(0,h.K)(e),d=(0,o.Fl)((()=>"function"===typeof e.counterValue?e.counterValue(u.value):(u.value||"").toString().length)),p=(0,o.Fl)((()=>t.maxlength?t.maxlength:!e.counter||"number"!==typeof e.counter&&"string"!==typeof e.counter?void 0:e.counter));function g(l,t){e.autofocus&&l&&t[0].target?.focus?.()}const y=(0,i.iH)(),b=(0,i.iH)(),C=(0,i.iH)(""),_=(0,i.iH)(),F=(0,o.Fl)((()=>s.value||e.persistentPlaceholder)),H=(0,o.Fl)((()=>e.messages.length?e.messages:F.value||e.persistentHint?e.hint:""));function S(){_.value!==document.activeElement&&_.value?.focus(),s.value||r()}function U(e){S(),a("click:control",e)}function z(e){a("mousedown:control",e)}function P(l){l.stopPropagation(),S(),(0,o.Y3)((()=>{u.value="",(0,k.dr)(e["onClick:clear"],l)}))}function B(e){u.value=e.target.value}const M=(0,i.iH)();function T(){e.autoGrow&&(0,o.Y3)((()=>{if(!M.value||!b.value)return;const l=getComputedStyle(M.value),t=getComputedStyle(b.value.$el),a=parseFloat(l.getPropertyValue("--v-field-padding-top"))+parseFloat(l.getPropertyValue("--v-input-padding-top"))+parseFloat(l.getPropertyValue("--v-field-padding-bottom")),o=M.value.scrollHeight,n=parseFloat(l.lineHeight),u=Math.max(parseFloat(e.rows)*n+a,parseFloat(t.getPropertyValue("--v-input-control-height"))),i=parseFloat(e.maxRows)*n+a||1/0;C.value=(0,k.kb)((0,k.uZ)(o??0,u,i))}))}let Y;return(0,o.bv)(T),(0,o.YP)(u,T),(0,o.YP)((()=>e.rows),T),(0,o.YP)((()=>e.maxRows),T),(0,o.YP)((()=>e.density),T),(0,o.YP)(M,(e=>{e?(Y=new ResizeObserver(T),Y.observe(M.value)):Y?.disconnect()})),(0,o.Jd)((()=>{Y?.disconnect()})),(0,W.L)((()=>{const l=!!(n.counter||e.counter||e.counterValue),a=!(!l&&!n.details),[i,r]=(0,k.An)(t),[{modelValue:x,...h}]=(0,f.PE)(e),[V]=(0,v.g8)(e);return(0,o.Wm)(f.q8,(0,o.dG)({ref:y,modelValue:u.value,"onUpdate:modelValue":e=>u.value=e,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-text-field--flush-details":["plain","underlined"].includes(e.variant)}],"onClick:prepend":e["onClick:prepend"],"onClick:append":e["onClick:append"]},i,h,{focused:s.value,messages:H.value}),{...n,default:l=>{let{isDisabled:t,isDirty:a,isReadonly:i,isValid:d}=l;return(0,o.Wm)(v.hF,(0,o.dG)({ref:b,style:{"--v-textarea-control-height":C.value},onClick:U,onMousedown:z,"onClick:clear":P,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"],role:"textbox"},V,{active:F.value||a.value,dirty:a.value||e.dirty,focused:s.value,error:!1===d.value}),{...n,default:l=>{let{props:{class:a,...n}}=l;return(0,o.Wm)(o.HY,null,[e.prefix&&(0,o.Wm)("span",{class:"v-text-field__prefix"},[e.prefix]),(0,o.wy)((0,o.Wm)("textarea",(0,o.dG)({ref:_,class:a,value:u.value,onInput:B,autofocus:e.autofocus,readonly:i.value,disabled:t.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:S,onBlur:c},n,r),null),[[(0,o.Q2)("intersect"),{handler:g},null,{once:!0}]]),e.autoGrow&&(0,o.wy)((0,o.Wm)("textarea",{class:[a,"v-textarea__sizer"],"onUpdate:modelValue":e=>u.value=e,ref:M,readonly:!0,"aria-hidden":"true"},null),[[m.nr,u.value]]),e.suffix&&(0,o.Wm)("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:a?t=>(0,o.Wm)(o.HY,null,[n.details?.(t),l&&(0,o.Wm)(o.HY,null,[(0,o.Wm)("span",null,null),(0,o.Wm)(w._,{active:e.persistentCounter||s.value,value:d.value,max:p.value},n.counter)])]):void 0})})),(0,x.F)({},y,b,_)}});var C=t(870),_=t(3369),F=t(6824),H=t(8521),S=t(1332),U=t(1334),z=t(3968),P=t(2257),B=t(4359),M=t(7327);class T extends z.Hn{static fields(){return{id:this.string(""),topic:this.string(""),bucket:this.string(""),process:this.string(""),collection:this.string(""),subscribed:this.boolean(!1)}}}(0,M.Z)(T,"entity","mqtt_subscription");var Y=(0,o.aZ)({name:"wis2-subscription",props:{},components:{VCard:s._,VCardTitle:r.E,VCardText:c.Z,VForm:d.O,VTextField:p.hw,VTextarea:b,VBtn:C.T,VContainer:_.K,VRow:F.o,VCol:H.D,VFor:a.VFor,BaseMap:P.Z,FeatureMap:B.Z,VCardSubtitle:S.Q,VCardActions:U.h},methods:{},setup(e,{emit:l}){const t=(0,i.iH)(null),a=(0,i.iH)(-180),o=(0,i.iH)(-90),n=(0,i.iH)(180),u=(0,i.iH)(90),s=(0,i.iH)(null),r=(0,i.iH)({features:[]}),c=(0,i.iH)(null);(0,i.iH)(null);c.value=(0,z.lL)(T);const d=async e=>{t.value=e},p=e=>{var l=t.value.getBounds();a.value=l.getWest(),o.value=l.getSouth(),n.value=l.getEast(),u.value=l.getNorth()},m=async()=>{var e=`&bbox=${a.value},${o.value},${n.value},${u.value}`,l="?";null!=s.value?(s.value.endsWith(";")&&(s.value=s.value.slice(0,-1)),l=l+"q="+s.value.replace(/;/g," AND ")):(console.log(!(null==s.value)),console.log(s.value)),console.log(l+e);const t="https://api.weather.gc.ca/collections/wis2-discovery-metadata/items",i=`${t}${l}${e}`;console.log(i);const c=await fetch(i),d=await c.json();console.log(d),r.value=d},v=e=>{for(const t of e.links)if("data"!=t.rel||"MQTT"!=t.type&&"mqtt"!=t.type)console.log("No MQTT");else{console.log("MQTT found"),console.log(t),console.log(e);var l={id:e.id,topic:t["wmo:topic"]?t["wmo:topic"]:t["channel"],bucket:"wis2subs",process:"ingestBUFR",subscribed:!0};(0,z.lL)(T).insert(l),console.log((0,z.lL)(T).all())}},f=e=>{var l="https://api.weather.gc.ca/collections/wis2-discovery-metadata/items/"+e.id;window.open(l)};return{mapEvent:p,onMapLoaded:d,minx:a,miny:o,maxx:n,maxy:u,keywords:s,parseLinks:v,searchCatalogue:m,collections:r,moreInformation:f}}}),L=t(89);const N=(0,L.Z)(Y,[["render",u]]);var I=N}}]);
//# sourceMappingURL=7342.8fd9f0e1.js.map