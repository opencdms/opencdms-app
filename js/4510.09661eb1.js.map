{"version":3,"file":"js/4510.09661eb1.js","mappings":"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","sources":["webpack://opencdms-app/./src/views/station-import.vue","webpack://opencdms-app/./src/web-components/station-import.vue","webpack://opencdms-app/./src/web-components/station-import.vue?9cdc","webpack://opencdms-app/./src/views/station-import.vue?8cf0","webpack://opencdms-app/../../../src/components/VForm/VForm.tsx"],"sourcesContent":["<template>\n  <div>\n    <station-import/>\n  </div>\n</template>\n\n<script>\nimport StationImport from './../web-components/station-import.vue';\n\n\nexport default {\n  name: 'MyView',\n  components: {\n    StationImport,\n  },\n};\n</script>\n\n<style>\n</style>\n","<template>\n  <v-container>\n    <v-card>\n      <v-card-title>Import station from OSCAR/Surface</v-card-title>\n      <v-card-text>\n        <v-form>\n          <v-text-field clearable :rules=\"[rules.validWSI]\" label=\"WIGOS Identifier\" v-model=\"wigos_identifier\"/>\n          <v-btn @click=\"search\">Search</v-btn>\n        </v-form>\n      </v-card-text>\n    </v-card>\n  </v-container>\n</template>\n\n<script>\n  import { defineComponent, ref, watchEffect, computed, watch } from 'vue';\n  import { VCard, VCardTitle, VCardText, VCardItem, VTabs, VTab, VBtn, VAutocomplete, VCardSubtitle, VTextField } from 'vuetify/lib/components';\n  import { VContainer, VForm } from 'vuetify/lib/components';\n\n  // opencdms imports\n  import Host from '@/models/Host';\n  import {flatten_geojson} from '@/utils/geojson.js';\n  import {loadData} from '@/utils/load-data.js';\n  import { useRoute, useRouter } from 'vue-router';\n  import {useRepo} from 'pinia-orm';\n\n\n  export default defineComponent({\n    name: 'import-wmdr-host',\n    components: {\n      VContainer, VBtn, VForm, VTextField,\n      VCard, VCardTitle, VCardText\n    },\n    setup(props, {context}){\n      const router = useRouter();\n      const wigos_identifier = ref(\"\");\n      const rules = ref({\n        validWSI: value => /^0-[0-9]{1,5}-[0-9]{0,5}-[0-9a-zA-Z]{1,16}$/.test(value) || 'Invalid WSI',\n      });\n\n      const search = async () => {\n        //var oscar_url = \"https://oscar.wmo.int/surface/rest/api/search/station?wigosId=\";\n        //var query = oscar_url + wigos_identifier.value;\n        //console.log(query);\n        //var stations = await fetch(query).then(response => response.json());\n        //console.log(stations);\n        var payload = {\n          \"inputs\": {\n            WIGOS_identifier: wigos_identifier.value\n          },\n          \"outputs\": {\n            \"status\": null\n          }\n        }\n        payload = JSON.stringify(payload);\n        var url_ = process.env.API + \"/processes/ingestHost/execution\"\n        var response = await fetch( url_, {\n          method: 'POST',\n          body: payload,\n          headers: {\n            encode: 'json'\n          }\n        });\n\n        if(response.ok){\n          // reload host\n          await loadData(process.env.API + '/collections/stations/items?limit=1000&f=json', true)\n            .then( (result) => flatten_geojson(result.features) ).then( (result) => { useRepo(Host).save(result) });\n          var station_url = '#/station/' + wigos_identifier.value;\n          router.push('/station/'+wigos_identifier.value);\n        }else{\n          console.log(response);\n        }\n      };\n      return {rules, search, wigos_identifier};\n    }\n  });\n\n\n</script>\n","import { render } from \"./station-import.vue?vue&type=template&id=1bf7f2c7\"\nimport script from \"./station-import.vue?vue&type=script&lang=js\"\nexport * from \"./station-import.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"/home/runner/work/opencdms-app/opencdms-app/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","import { render } from \"./station-import.vue?vue&type=template&id=4f127de3\"\nimport script from \"./station-import.vue?vue&type=script&lang=js\"\nexport * from \"./station-import.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"/home/runner/work/opencdms-app/opencdms-app/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","// Composables\nimport { createForm, makeFormProps } from '@/composables/form'\nimport { forwardRefs } from '@/composables/forwardRefs'\n\n// Utilities\nimport { ref } from 'vue'\nimport { genericComponent, useRender } from '@/util'\n\n// Types\nimport type { SubmitEventPromise } from '@/composables/form'\n\nexport const VForm = genericComponent()({\n  name: 'VForm',\n\n  props: {\n    ...makeFormProps(),\n  },\n\n  emits: {\n    'update:modelValue': (val: boolean | null) => true,\n    submit: (e: SubmitEventPromise) => true,\n  },\n\n  setup (props, { slots, emit }) {\n    const form = createForm(props)\n    const formRef = ref<HTMLFormElement>()\n\n    function onReset (e: Event) {\n      e.preventDefault()\n      form.reset()\n    }\n\n    function onSubmit (_e: Event) {\n      const e = _e as SubmitEventPromise\n\n      const ready = form.validate()\n      e.then = ready.then.bind(ready)\n      e.catch = ready.catch.bind(ready)\n      e.finally = ready.finally.bind(ready)\n\n      emit('submit', e)\n\n      if (!e.defaultPrevented) {\n        ready.then(({ valid }) => {\n          if (valid) {\n            formRef.value?.submit()\n          }\n        })\n      }\n\n      e.preventDefault()\n    }\n\n    useRender(() => ((\n      <form\n        ref={ formRef }\n        class=\"v-form\"\n        novalidate\n        onReset={ onReset }\n        onSubmit={ onSubmit }\n      >\n        { slots.default?.(form) }\n      </form>\n    )))\n\n    return forwardRefs(form, formRef)\n  },\n})\n\nexport type VForm = InstanceType<typeof VForm>\n"],"names":["_createElementBlock","_createVNode","_component_station_import","_createBlock","_component_v_container","_component_v_card","_component_v_card_title","_component_v_card_text","_component_v_form","_component_v_text_field","clearable","rules","_ctx","validWSI","label","_component_v_btn","onClick","defineComponent","name","components","VContainer","VBtn","VForm","VTextField","VCard","VCardTitle","VCardText","setup","props","context","router","useRouter","wigos_identifier","ref","value","test","search","async","payload","WIGOS_identifier","JSON","stringify","url_","process","response","fetch","method","body","headers","encode","ok","loadData","then","result","flatten_geojson","features","useRepo","Host","save","push","console","log","__exports__","StationImport","render","genericComponent","makeFormProps","emits","val","submit","e","slots","emit","form","createForm","formRef","onReset","preventDefault","reset","onSubmit","_e","ready","validate","bind","catch","finally","defaultPrevented","_ref2","valid","useRender","default","forwardRefs"],"sourceRoot":""}