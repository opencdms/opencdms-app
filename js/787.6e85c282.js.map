{"version":3,"file":"js/787.6e85c282.js","mappings":"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","sources":["webpack://opencdms-app/./src/views/deployment-list.vue","webpack://opencdms-app/./src/web-components/deployment-list.vue","webpack://opencdms-app/./src/web-components/deployment-list.vue?6b08","webpack://opencdms-app/./src/views/deployment-list.vue?0b3e","webpack://opencdms-app/../../src/composables/filter.ts"],"sourcesContent":["<template>\n  <div>\n    <deployment-list title=\"deployment-list\" content=\"This page is under construction\" description=\"list of deployed sensors\" />\n  </div>\n</template>\n\n<script>\nimport DeploymentList from './../web-components/deployment-list.vue';\n\n\nexport default {\n  name: 'MyView',\n  components: {\n    DeploymentList,\n  },\n};\n</script>\n\n<style>\n</style>\n","<template>\n  <v-card>\n    <v-card-title>Stations</v-card-title>\n    <v-card-text>\n      <VTextField style=\"width: 400px;\" v-model=\"search\" prepend-icon=\"mdi-text-search\" label=\"search\" single-line hide-details></VTextField>\n      <VDataTable :headers=\"headers\" :items=\"items\" :search=\"search\" dense small>\n          <template v-slot:item.id=\"{ item }\">\n            <a :href=\"getIDLink(item.raw.id)\">{{item.raw.id}}</a>\n          </template>\n          <template v-slot:item.links=\"{ item }\">\n            {{parseLinks(item.raw.links)}}\n          </template>\n      </VDataTable>\n    </v-card-text>\n  </v-card>\n</template>\n\n<script>\nimport { defineComponent } from 'vue';\nimport { VCard, VCardTitle, VCardText, VChip } from 'vuetify/lib/components';\nimport { onBeforeMount, onMounted, onBeforeUpdate, onUpdated, onBeforeUnmount, onUnmounted, onErrorCaptured} from 'vue';\nimport { ref, computed, watchEffect, watch } from 'vue'\nimport { VDataTable } from 'vuetify/labs/VDataTable';\nimport { VTextField } from 'vuetify/lib/components';\nimport {useRepo} from 'pinia-orm';\nimport * as d3 from 'd3';\n\n// opencdms components\n\nimport Deployment from '@/models/Deployment';\n\nexport default defineComponent({\n  name: 'station-list',\n  props: {\n    connection: {\n      type: String,\n      default: \"/data/deployments.psv\"\n    }\n  },\n  components: {\n    VCard,\n    VCardTitle,\n    VCardText,\n    VDataTable,\n    VTextField,\n  },\n  methods: {\n    parseLinks (links) {\n      let res;\n      if( links && links.length > 0 ){\n        res = JSON.stringify(links);\n      }else{\n        res = '';\n      }\n      return res;\n    },\n    getIDLink (id) {\n      return '/#/deployment/'+id;\n    }\n  },\n  setup(props) {\n    const headers = ref([]);\n    const data = ref([]);\n    const search = ref(\"\");\n    const sortBy = ref([{key:\"\", order:\"desc\"}]);\n    const items = ref([]);\n    const selected = ref([]);\n\n    const deploymentRepo = useRepo(Deployment);\n\n    console.log(useRepo(Deployment).piniaStore());\n\n    const loadCSV = async (path) => {\n      let csvData;\n      csvData = await d3.dsv('|',path, d3.autoType);\n      return {csvData};\n    };\n\n    onMounted( async() => {\n        items.value = deploymentRepo.all();\n        headers.value = Object.keys(items.value[0]).map( key => ({\n          title: key,\n          value: key,\n          key: key,\n          sortable: true\n        }));\n        console.log(deploymentRepo.all()) ;\n\n      console.log(headers);\n      console.log(deploymentRepo.all());\n    });\n    return {headers, items, search, sortBy};\n  }\n\n});\n</script>\n","import { render } from \"./deployment-list.vue?vue&type=template&id=1525df91\"\nimport script from \"./deployment-list.vue?vue&type=script&lang=js\"\nexport * from \"./deployment-list.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"/home/runner/work/opencdms-app/opencdms-app/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","import { render } from \"./deployment-list.vue?vue&type=template&id=95bcf01a\"\nimport script from \"./deployment-list.vue?vue&type=script&lang=js\"\nexport * from \"./deployment-list.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"/home/runner/work/opencdms-app/opencdms-app/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","/* eslint-disable max-statements */\n/* eslint-disable no-labels */\n\n// Utilities\nimport { getPropertyFromItem, propsFactory, wrapInArray } from '@/util'\nimport { computed, ref, unref, watchEffect } from 'vue'\n\n// Types\nimport type { PropType, Ref } from 'vue'\nimport type { MaybeRef } from '@/util'\nimport type { InternalItem } from './items'\n\n/**\n * - match without highlight\n * - single match (index), length already known\n * - single match (start, end)\n * - multiple matches (start, end), probably shouldn't overlap\n */\nexport type FilterMatch = boolean | number | [number, number] | [number, number][]\nexport type FilterFunction = (value: string, query: string, item?: any) => FilterMatch\nexport type FilterKeyFunctions = Record<string, FilterFunction>\nexport type FilterKeys = string | string[]\nexport type FilterMode = 'some' | 'every' | 'union' | 'intersection'\n\nexport interface FilterProps {\n  customFilter?: FilterFunction\n  customKeyFilter?: FilterKeyFunctions\n  filterKeys?: FilterKeys\n  filterMode?: FilterMode\n  noFilter?: boolean\n}\n\n// Composables\nexport const defaultFilter: FilterFunction = (value, query, item) => {\n  if (value == null || query == null) return -1\n\n  return value.toString().toLocaleLowerCase().indexOf(query.toString().toLocaleLowerCase())\n}\n\nexport const makeFilterProps = propsFactory({\n  customFilter: Function as PropType<FilterFunction>,\n  customKeyFilter: Object as PropType<FilterKeyFunctions>,\n  filterKeys: [Array, String] as PropType<FilterKeys>,\n  filterMode: {\n    type: String as PropType<FilterMode>,\n    default: 'intersection',\n  },\n  noFilter: Boolean,\n}, 'filter')\n\nexport function filterItems (\n  items: InternalItem[],\n  query: string,\n  options?: {\n    customKeyFilter?: FilterKeyFunctions\n    default?: FilterFunction\n    filterKeys?: FilterKeys\n    filterMode?: FilterMode\n    noFilter?: boolean\n  },\n) {\n  const array: { index: number, matches: Record<string, FilterMatch> }[] = []\n  // always ensure we fall back to a functioning filter\n  const filter = options?.default ?? defaultFilter\n  const keys = options?.filterKeys ? wrapInArray(options.filterKeys) : false\n  const customFiltersLength = Object.keys(options?.customKeyFilter ?? {}).length\n\n  if (!items?.length) return array\n\n  loop:\n  for (let i = 0; i < items.length; i++) {\n    const item = items[i]\n    const customMatches: Record<string, FilterMatch> = {}\n    const defaultMatches: Record<string, FilterMatch> = {}\n    let match: FilterMatch = -1\n\n    if (query && !options?.noFilter) {\n      if (typeof item === 'object') {\n        const filterKeys = keys || Object.keys(item)\n\n        for (const key of filterKeys) {\n          const value = getPropertyFromItem(item as any, key, item)\n          const keyFilter = options?.customKeyFilter?.[key]\n\n          match = keyFilter\n            ? keyFilter(value, query, item)\n            : filter(value, query, item)\n\n          if (match !== -1 && match !== false) {\n            if (keyFilter) customMatches[key] = match\n            else defaultMatches[key] = match\n          } else if (options?.filterMode === 'every') {\n            continue loop\n          }\n        }\n      } else {\n        match = filter(item, query, item)\n        if (match !== -1 && match !== false) {\n          defaultMatches.title = match\n        }\n      }\n\n      const defaultMatchesLength = Object.keys(defaultMatches).length\n      const customMatchesLength = Object.keys(customMatches).length\n\n      if (!defaultMatchesLength && !customMatchesLength) continue\n\n      if (\n        options?.filterMode === 'union' &&\n        customMatchesLength !== customFiltersLength &&\n        !defaultMatchesLength\n      ) continue\n\n      if (\n        options?.filterMode === 'intersection' &&\n        (\n          customMatchesLength !== customFiltersLength ||\n          !defaultMatchesLength\n        )\n      ) continue\n    }\n\n    array.push({ index: i, matches: { ...defaultMatches, ...customMatches } })\n  }\n\n  return array\n}\n\nexport function useFilter <T extends InternalItem> (\n  props: FilterProps,\n  items: MaybeRef<T[]>,\n  query: Ref<string | undefined>,\n  options?: {\n    filterKeys?: MaybeRef<FilterKeys>\n  }\n) {\n  const strQuery = computed(() => (\n    typeof query?.value !== 'string' &&\n    typeof query?.value !== 'number'\n  ) ? '' : String(query.value))\n\n  const filteredItems: Ref<T[]> = ref([])\n  const filteredMatches: Ref<Map<unknown, Record<string, FilterMatch>>> = ref(new Map())\n\n  watchEffect(() => {\n    filteredItems.value = []\n    filteredMatches.value = new Map()\n\n    const transformedItems = unref(items)\n    const results = filterItems(\n      transformedItems,\n      strQuery.value,\n      {\n        customKeyFilter: props.customKeyFilter,\n        default: props.customFilter,\n        filterKeys: unref(options?.filterKeys) ?? props.filterKeys,\n        filterMode: props.filterMode,\n        noFilter: props.noFilter,\n      },\n    )\n\n    results.forEach(({ index, matches }) => {\n      const item = transformedItems[index]\n      filteredItems.value.push(item)\n      filteredMatches.value.set(item.value, matches)\n    })\n  })\n\n  function getMatches (item: T) {\n    return filteredMatches.value.get(item.value)\n  }\n\n  return { filteredItems, filteredMatches, getMatches }\n}\n"],"names":["_createElementBlock","_createVNode","_component_deployment_list","title","content","description","_createBlock","_component_v_card","_component_v_card_title","_component_v_card_text","_component_VTextField","style","_ctx","label","_component_VDataTable","headers","items","search","dense","small","item","_createElementVNode","href","raw","id","links","defineComponent","name","props","connection","type","String","default","components","VCard","VCardTitle","VCardText","VDataTable","VTextField","methods","parseLinks","res","length","JSON","stringify","getIDLink","setup","ref","sortBy","key","order","deploymentRepo","useRepo","Deployment","console","log","piniaStore","onMounted","async","value","all","Object","keys","map","sortable","__exports__","DeploymentList","render","defaultFilter","query","toString","toLocaleLowerCase","indexOf","makeFilterProps","propsFactory","customFilter","Function","customKeyFilter","filterKeys","Array","filterMode","noFilter","Boolean","filterItems","options","array","filter","wrapInArray","customFiltersLength","loop","i","customMatches","defaultMatches","match","getPropertyFromItem","keyFilter","defaultMatchesLength","customMatchesLength","push","index","matches","useFilter","strQuery","computed","filteredItems","filteredMatches","Map","getMatches","get","watchEffect","transformedItems","unref","results","forEach","_ref","set"],"sourceRoot":""}